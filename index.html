<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=1000, initial-scale=1.0" />
    <title>Grocerise</title>
    <link
      href="https://fonts.googleapis.com/css?family=Crimson+Text|Unica+One"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center">
          <h3 class="animate-charcter">Grocery Scrape</h3>
        </div>
      </div>
    </div>

    <p class="blocktext">
      Getting your groceries is expensive. Where do you to get the most bang for
      your buck? Check out the grid.
    </p>

    <div class="grid_container">
      <div></div>
      <div class="grid-title superstoreCol">
        <img src="superstore.svg" alt="Superstore" width="75%" height="75%" />
      </div>
      <div class="grid-title safewayCol">
        <img
          src="Safeway_Inc.-Logo.svg"
          alt="Safeway"
          width="75%"
          height="75%"
        />
      </div>
      <div class="grid-title Walmartcol">
        <img src="Walmart_logo.svg" alt="Walmart" width="75%" height="75%" />
      </div>
      <div class="grid-title NoFrills">
        <img src="No_Frills_logo.svg" alt="NoFrills" width="75%" height="75%" />
      </div>

      <div class="grid-title titleRow">Total</div>
      <div class="grid-item" id="SuperstoreTotal"></div>
      <div class="grid-item" id="SafewayTotal"></div>
      <div class="grid-item" id="WalmartTotal"></div>
      <div class="grid-item" id="NoFrillTotal"></div>

      <div class="grid-title milkrow">
        <img
          src="milk-bottle-svgrepo-com.svg"
          width="75%"
          height="75%"
          alt="Milk"
        />
      </div>
      <div class="grid-item" id="Superstoremilk"></div>
      <div class="grid-item" id="Safewaymilk"></div>
      <div class="grid-item" id="Walmartmilk"></div>
      <div class="grid-item" id="NoFrillsmilk"></div>
      <div class="grid-title Eggsrow">
        <img src="eggs-svgrepo-com.svg" width="75%" height="75%" alt="Eggs" />
      </div>
      <div class="grid-item" id="Superstoreegg"></div>
      <div class="grid-item" id="Safewayegg"></div>
      <div class="grid-item" id="Walmartegg"></div>
      <div class="grid-item" id="NoFrillsegg"></div>
      <div class="grid-title Ricerow">
        <img src="rice-svgrepo-com.svg" width="75%" height="75%" alt="Eggs" />
      </div>
      <div class="grid-item" id="Superstorerice"></div>
      <div class="grid-item" id="Safewayrice"></div>
      <div class="grid-item" id="Walmartrice"></div>
      <div class="grid-item" id="NoFrillsrice"></div>
      <div class="grid-title Chickenrow">
        <img
          src="chicken-2-svgrepo-com.svg"
          width="75%"
          height="75%"
          alt="Chicken"
        />
      </div>
      <div class="grid-item" id="Superstorechicken"></div>
      <div class="grid-item" id="Safewaychicken"></div>
      <div class="grid-item" id="Walmartchicken"></div>
      <div class="grid-item" id="NoFrillschicken"></div>
    </div>

    <hr />

    <script>
      let items = ["milk", "egg", "chicken", "rice"];
      let shops = ["Walmart", "Safeway", "NoFrills", "Superstore"];

      async function fetchPricesJSON(thing, store) {
        const response = await fetch("priceHistory.json");
        priceArray = await response.json();
        const categoryPrices = priceArray.filter(
          (entry) => entry.item === thing
        );
        //console.log(store);
        const categoryPricesStore = categoryPrices.filter(
          (entry) => entry.shop === store
        );
        categoryPricesStore.sort((a, b) => new Date(b.day) - new Date(a.day));
        //console.log(categoryPricesStore);
        const newestEntry = categoryPricesStore[0];
        //console.log(newestEntry);
        let gridId = newestEntry.shop + newestEntry.item;
        //console.log(gridId);
        document.getElementById(gridId).innerHTML = "$" + newestEntry.cost;
      }
      // async function loadJSON() {
      //   const response = await fetch("priceHistory.json");
      //   let jsonArray = await response.json();
      //   return jsonArray;
      // }

      // let priceJSON = await loadJSON();
      // console.log(priceJSON);
      // let shopArray = [...new Set(priceJSON.map((item) => item.shop))];
      // let itemArray = [...new Set(priceJSON.map((item) => item.item))];
      // console.log(shopArray);
      // console.log(itemArray);

      items.forEach((item) => {
        shops.forEach((shop) => {
          fetchPricesJSON(item, shop);
        });
      });
      // Calculate the sum and update the total
      calculateAndDisplayTotal();

      async function calculateAndDisplayTotal() {
        let superstoreSum =
          Number(
            document
              .getElementById("Superstorechicken")
              .textContent.replace("$", "")
          ) +
          Number(
            document
              .getElementById("Superstorerice")
              .textContent.replace("$", "")
          ) +
          Number(
            document
              .getElementById("Superstoremilk")
              .textContent.replace("$", "")
          ) +
          Number(
            document
              .getElementById("Superstoreegg")
              .textContent.replace("$", "")
          );

        console.log(superstoreSum);

        document.getElementById("SuperstoreTotal").innerHTML =
          "$ " + superstoreSum;
      }
    </script>
  </body>
</html>
