<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=1000, initial-scale=1.0" />
    <title>Grocerise</title>
    <link
      href="https://fonts.googleapis.com/css?family=Crimson+Text|Unica+One"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center">
          <h3 class="animate-charcter">Grocerise</h3>
        </div>
      </div>
    </div>
    
    <p>
      Getting your groceries is expensive. Where do you to get the most bang for
      your buck? Check out the grid.
    </p>

    <div class="grid_container">
      <div></div>
      <div class="grid-title superstoreCol">
        <img src="superstore.svg" alt="Superstore" width="75%" height="75%" />
      </div>
      <div class="grid-title safewayCol">
        <img
          src="Safeway_Inc.-Logo.svg"
          alt="Safeway"
          width="75%"
          height="75%"
        />
      </div>
      <div class="grid-title Walmartcol">
        <img src="Walmart_logo.svg" alt="Walmart" width="75%" height="75%" />
      </div>
      <div class="grid-title NoFrills">
        <img src="No_Frills_logo.svg" alt="NoFrills" width="75%" height="75%" />
      </div>

      <div class="grid-title titleRow">Total</div>
      <div class="grid-item" id="SuperstoreTotal"></div>
      <div class="grid-item" id="SafewayTotal"></div>
      <div class="grid-item" id="WalmartTotal"></div>
      <div class="grid-item" id="NoFrillsTotal"></div>

      <div class="grid-title milkrow">
        <img
          src="milk-bottle-svgrepo-com.svg"
          width="75%"
          height="75%"
          alt="Milk"
        />
      </div>
      <div class="grid-item" id="Superstoremilk"></div>
      <div class="grid-item" id="Safewaymilk"></div>
      <div class="grid-item" id="Walmartmilk"></div>
      <div class="grid-item" id="NoFrillsmilk"></div>
      <div class="grid-title Eggsrow">
        <img src="eggs-svgrepo-com.svg" width="75%" height="75%" alt="Eggs" />
      </div>
      <div class="grid-item" id="Superstoreegg"></div>
      <div class="grid-item" id="Safewayegg"></div>
      <div class="grid-item" id="Walmartegg"></div>
      <div class="grid-item" id="NoFrillsegg"></div>
      <div class="grid-title Ricerow">
        <img src="rice-svgrepo-com.svg" width="75%" height="75%" alt="Eggs" />
      </div>
      <div class="grid-item" id="Superstorerice"></div>
      <div class="grid-item" id="Safewayrice"></div>
      <div class="grid-item" id="Walmartrice"></div>
      <div class="grid-item" id="NoFrillsrice"></div>
      <div class="grid-title Chickenrow">
        <img
          src="chicken-2-svgrepo-com.svg"
          width="75%"
          height="75%"
          alt="Chicken"
        />
      </div>
      <div class="grid-item" id="Superstorechicken"></div>
      <div class="grid-item" id="Safewaychicken"></div>
      <div class="grid-item" id="Walmartchicken"></div>
      <div class="grid-item" id="NoFrillschicken"></div>
      <div class="grid-title Towelrow">
        <img
          src="towel-paper.svg"
          width="75%"
          height="75%"
          alt="Paper Towel"
        />
      </div>
      <div class="grid-item" id="Superstoretowel"></div>
      <div class="grid-item" id="Safewaytowel"></div>
      <div class="grid-item" id="Walmarttowel"></div>
      <div class="grid-item" id="NoFrillstowel"></div>
    </div>
    </div>


    <script>
      const delay = (milliseconds) =>
        new Promise((resolve) => setTimeout(resolve, milliseconds));
  
      async function fetchPricesJSON(thing, store) {
        const response = await fetch("priceHistory.json");
        priceArray = await response.json();
        const categoryPrices = priceArray.filter(
          (entry) => entry.item === thing
        );
        //console.log(store);
        const categoryPricesStore = categoryPrices.filter(
          (entry) => entry.shop === store
        );
        categoryPricesStore.sort((a, b) => new Date(b.day) - new Date(a.day));
        //console.log(categoryPricesStore);
        const newestEntry = categoryPricesStore[0];
        //console.log(newestEntry);
        let gridId = newestEntry.shop + newestEntry.item;
        //console.log(gridId);
        document.getElementById(gridId).innerHTML = "$" + newestEntry.cost;
      }

      let globalArray = [];
      let shopArray=[];
      let itemArray=[];

      async function loadJSON() {
        const response = await fetch("priceHistory.json");
        let jsonArray = await response.json();
        globalArray = jsonArray;
  
      }

      async function loading(){
        await loadJSON();

        console.log(globalArray);
        shopArray = [...new Set(globalArray.map((item) => item.shop))];
        itemArray = [...new Set(globalArray.map((item) => item.item))];
         itemArray.forEach((item) => {
          shopArray.forEach((shop) => {
            fetchPricesJSON(item, shop);
          });
        });
      }
loading();

      // Calculate the sum and update the total
      calculateAndDisplayTotal();

      async function calculateAndDisplayTotal() {
        await delay(500);
        let superstoreSum =
          Number(
            document
              .getElementById("Superstorechicken")
              .textContent.replace("$", "")
          ) +
          Number(
            document
              .getElementById("Superstorerice")
              .textContent.replace("$", "")
          ) +
          Number(
            document
              .getElementById("Superstoremilk")
              .textContent.replace("$", "")
          ) +
          Number(
            document
              .getElementById("Superstoreegg")
              .textContent.replace("$", "")
          )
          +
          Number(
            document
              .getElementById("Superstoretowel")
              .textContent.replace("$", "")
          );

        console.log(superstoreSum.toFixed(2));

        document.getElementById("SuperstoreTotal").innerHTML =
          "$ " + superstoreSum.toFixed(2);

        let safewaySum =
          Number(
            document
              .getElementById("Safewaychicken")
              .textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("Safewayrice").textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("Safewaymilk").textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("Safewayegg").textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("Safewaytowel").textContent.replace("$", "")
          );

        console.log(safewaySum.toFixed(2));

        document.getElementById("SafewayTotal").innerHTML =
          "$ " + safewaySum.toFixed(2);

        let walmartSum =
          Number(
            document
              .getElementById("Walmartchicken")
              .textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("Walmartrice").textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("Walmartmilk").textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("Walmartegg").textContent.replace("$", "")
          )  +
          Number(
            document.getElementById("Walmarttowel").textContent.replace("$", "")
          );

        console.log(walmartSum.toFixed(2));

        document.getElementById("WalmartTotal").innerHTML =
          "$ " + walmartSum.toFixed(2);

        let nofrillsSum =
          Number(
            document
              .getElementById("NoFrillschicken")
              .textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("NoFrillsrice").textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("NoFrillsmilk").textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("NoFrillsegg").textContent.replace("$", "")
          ) +
          Number(
            document.getElementById("NoFrillstowel").textContent.replace("$", "")
          );

        console.log(nofrillsSum.toFixed(2));

        document.getElementById("NoFrillsTotal").innerHTML =
          "$ " + nofrillsSum.toFixed(2);
      }
    </script>
  </body>
</html>
